<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visor de Documentos de Drive</title>
    <!-- Tailwind CSS para un diseño moderno y limpio -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Estilos adicionales para mejorar la apariencia */
        body {
            font-family: 'Inter', sans-serif;
        }
        .loader {
            border-top-color: #3498db;
            -webkit-animation: spin 1s linear infinite;
            animation: spin 1s linear infinite;
        }
        @-webkit-keyframes spin {
            0% { -webkit-transform: rotate(0deg); }
            100% { -webkit-transform: rotate(360deg); }
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
    <!-- Fuente Inter desde Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">

    <div class="w-full max-w-4xl mx-auto p-4 md:p-8">
        <div class="bg-white rounded-2xl shadow-lg p-6 md:p-8">
            <div class="text-center mb-6">
                <h1 class="text-2xl md:text-3xl font-bold text-gray-800">Visor de Documentos PDF</h1>
                <p class="text-gray-500 mt-2">Introduce el código único del documento para visualizarlo.</p>
            </div>

            <!-- Sección de entrada de código -->
            <div class="flex flex-col sm:flex-row gap-3 mb-6">
                <input type="text" id="documentCodeInput" placeholder="Introduce el código aquí..." class="flex-grow w-full px-4 py-3 text-gray-700 bg-gray-50 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200">
                <button id="showDocumentBtn" class="w-full sm:w-auto bg-blue-600 text-white font-semibold py-3 px-6 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 transition duration-200 shadow-md">
                    Mostrar Documento
                </button>
            </div>

            <!-- Contenedor para mostrar el PDF o mensajes -->
            <div id="documentViewer" class="bg-gray-50 rounded-lg border border-gray-200 min-h-[60vh] flex items-center justify-center transition-all duration-300">
                <div id="placeholder" class="text-center text-gray-400">
                    <svg xmlns="http://www.w3.org/2000/svg" class="mx-auto h-12 w-12" fill="none" viewBox="0-0 24 24" stroke="currentColor" stroke-width="1">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                    <p class="mt-2">El documento aparecerá aquí.</p>
                </div>
                 <div id="loader" class="hidden loader ease-linear rounded-full border-4 border-t-4 border-gray-200 h-12 w-12"></div>
            </div>
        </div>
        <footer class="text-center mt-6 text-gray-500 text-sm">
            <p>&copy; 2024 Visor de Documentos. Creado para una fácil integración con Google Drive.</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- CONFIGURACIÓN IMPORTANTE ---
            // Pega aquí la URL de tu aplicación web de Google Apps Script.
            const appsScriptUrl = 'https://script.google.com/macros/s/AKfycbzZERMuq6lz7_CHJXhg8XHPbYgv6Y-geFdSSDZseUSaE3gnk4Bf0FWE2uxA-5D8mgSa/exec';

            const codeInput = document.getElementById('documentCodeInput');
            const showBtn = document.getElementById('showDocumentBtn');
            const viewerContainer = document.getElementById('documentViewer');
            const placeholder = document.getElementById('placeholder');
            const loader = document.getElementById('loader');

            const showDocument = async () => {
                const code = codeInput.value.trim();
                if (code === '') {
                    displayMessage('info', 'Por favor, introduce un código para buscar.');
                    return;
                }
                
                // CORRECCIÓN: Se revierte al valor original para que la comprobación funcione.
                if (appsScriptUrl === 'URL_DE_TU_SCRIPT_AQUI') {
                    displayMessage('error', 'Error de configuración: La URL del script de Google no ha sido establecida en el archivo HTML.');
                    return;
                }

                // Mostrar el loader y limpiar la vista
                viewerContainer.innerHTML = '';
                viewerContainer.appendChild(loader);
                loader.classList.remove('hidden');

                try {
                    // Se ha cambiado la llamada a un método GET simple, que es más robusto para este tipo de script.
                    const response = await fetch(`${appsScriptUrl}?code=${encodeURIComponent(code)}`);
                    const data = await response.json();

                    if (data.status === 'success' && data.fileId) {
                        const fileId = data.fileId;
                        // CAMBIO: Se usa "/embed" en lugar de "/preview" para ocultar el encabezado y el botón de ventana emergente.
                        const embedUrl = `https://drive.google.com/file/d/${fileId}/embed`;

                        const iframe = document.createElement('iframe');
                        iframe.src = embedUrl;
                        iframe.className = 'w-full h-full min-h-[60vh] border-0 rounded-b-lg';
                        
                        loader.classList.add('hidden');
                        viewerContainer.innerHTML = '';
                        viewerContainer.appendChild(iframe);

                    } else {
                        displayMessage('error', data.message || `Documento no encontrado para el código: <strong>${code}</strong>.`);
                    }
                } catch (error) {
                    console.error("Error al llamar al script:", error);
                    displayMessage('error', 'No se pudo conectar con el servicio de búsqueda. Revisa la URL del script y tu conexión.');
                }
            };
            
            const displayMessage = (type, message) => {
                loader.classList.add('hidden');
                viewerContainer.innerHTML = '';
                const messageDiv = document.createElement('div');
                messageDiv.className = 'text-center p-8';
                
                let icon = '';
                let textColor = 'text-gray-500';

                if (type === 'error') {
                    icon = `<svg xmlns="http://www.w3.org/2000/svg" class="mx-auto h-12 w-12 text-red-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>`;
                    textColor = 'text-red-600';
                } else { // info
                    icon = `<svg xmlns="http://www.w3.org/2000/svg" class="mx-auto h-12 w-12 text-blue-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1"><path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>`;
                    textColor = 'text-blue-600';
                }
                
                messageDiv.innerHTML = `${icon}<p class="mt-2 font-semibold ${textColor}">${message}</p>`;
                viewerContainer.appendChild(messageDiv);
            };

            showBtn.addEventListener('click', showDocument);

            codeInput.addEventListener('keyup', (event) => {
                if (event.key === 'Enter') {
                    showDocument();
                }
            });
            
            viewerContainer.innerHTML = '';
            viewerContainer.appendChild(placeholder);
        });
    </script>

</body>
</html>

